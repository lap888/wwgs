function getUrlParam(n){var i=new RegExp("(^|&)"+n+"=([^&]*)(&|$)"),t=window.location.search.substr(1).match(i);return t!=null?unescape(t[2]):null}function formDate(n){if(n!="")return new Date(n)}function block(){var n=appendHtmlFile("#_block_","/template/block.html");n.show()}function unblock(){$("#_block_").hide()}function loadHtmlFile(n){var t="";return n=$url(n),jQuery.ajax({url:n,type:"GET",async:!1,success:function(n){t=n}}),t}function appendHtmlFile(n,t){return typeof n=="string"&&(n=$(n)),n.length==0&&(n=$(loadHtmlFile(t)),$(document.body).append(n)),n}function $url(n){if(webPath||alert("webPath:"+webPath),n.indexOf("http:")!=0&&n.indexOf("https:")!=0){var t=new RegExp(webPath+"/","ig");n=n.replace(t,"/");n=(webPath+"/"+n).replace(/:\/\//ig,"~").replace(/[\/]+/ig,"/").replace(/~/ig,"://")}return n}function $Alert(n,t){var u,i,r;n=n||"";u={};unblock();i=appendHtmlFile($("#__alert"),"/template/alert.html");i.off("hidden.bs.modal");i.on("hidden.bs.modal",function(){typeof u.func=="function"&&u.func()});if(i.modal({show:!0,backdrop:"static"}),n instanceof Element)i.find(".modal-body").html("").append(n);else if(n&&n.indexOf("<html")>-1){if(i.find(".modal-body").css("padding","0 15px"),r=i.find(".modal-body #content").contents(),r.length>0){r[0].open();r[0].write(n);r[0].close();try{r[0].window.resize();r[0].body.style.color="#4465a2"}catch(f){}}}else n=n.replace(/[\r\n]/ig,"<br/>"),r=i.find(".modal-body").html(n||"");return t&&typeof t=="string"&&i.find(".modal-title").text(t),u.then=function(n){u.func=n},u}function $AlertUrl(n){var t,i;n=n||"";t={};unblock();i=appendHtmlFile($("#__alert"),"/template/alertPage.html?t="+new Date);i.off("hidden.bs.modal");i.on("hidden.bs.modal",function(){typeof t.func=="function"&&t.func()});return i.modal({show:!0,backdrop:"static"}),i.find("#content")[0].src=n,t.then=function(n){t.func=n},t}function $Confirm(n,t,i){var u={},r,f;unblock();r=appendHtmlFile($("#__confirm"),"/template/confirm.html?t="+new Date);i=i||"确认操作";r.find(".modal-title").text(i);r.modal({show:!0,backdrop:"static"});f=r.find(".modal-body").html(n);r.off("hidden.bs.modal");r.on("hidden.bs.modal",function(){typeof u.func=="function"&&u.func()});r.find("#confirm-btn").one("click",function(){r.modal("hide");u.func=t})}function autoIframe(n,t){return}function queryService(n,t){function i(i,f,e,o){var h,c,l,s;f=$url(f);block();h=e;c=null;typeof e=="function"?(h=null,c=e):c=o;l={method:i,url:f,headers:{"Content-Type":undefined,"X-Requested-With":"JSON"},data:h};switch(i){case"GET":l.params=h;break;case"PUT":case"POST":l.headers["Content-Type"]="application/json; charset=utf-8"}return s=t.defer(),n(l).then(function(n){var t=r(n),i;console.log(f,h,t);unblock();try{if(t.status&&t.status!==200){u(t,f,c);s.reject(t);return}i=c(t);i?s.resolve(i):s.resolve(t)}catch(e){console.info(e);$Alert(e.message)}},function(n){var t=r(n);console.info("Error",t);unblock();u(t,f);s.reject(t)}),s.promise}function r(n){var t={status:n.status,message:n.statusText};return n.data&&(typeof n.data=="string"?t.message=n.data:(t=n.data,t&&!t.message&&(t.message=n.statusText))),t.message&&t.message.length!=0||(t.message="response 未知错误!"),t}function u(n,t,i){var r,u;if(unblock(),r=n.message,!r){u=n.status;switch(u){case 404:r="请求的资源不存在: "+t;break;case 401:$Alert("请登录!").then(function(){top.location.href=window.webPath});return}}$Alert(r);i&&i(n)}return this.put=function(n,t,r){return i("PUT",n,t,r)},this.get=function(n,t,r){return i("GET",n,t,r)},this.delete=function(n,t,r){return i("DELETE",n,t,r)},this.post=function(n,t,r){return i("POST",n,t,r)},this.head=function(n,t,r){return i("HEAD",n,t,r)},this.jsonp=function(n,t,r){return i("JSONP",n,t,r)},this.patch=function(n,t,r){return i("PATCH",n,t,r)},this}function $moment(n){return moment.locale("zh-cn"),moment(new Date(n))}var webPath=window.webPath,_dateOption,_dateTimeOption;typeof moment=="function"&&moment.locale("zh-cn");window.autoIframe=autoIframe;var $angular={add:function(n,t){var i,r;if(this.funcList==null&&(this.funcList=[]),this.funcIndex==null&&(this.funcIndex=[]),i=t||this.funcList.length,t==undefined){for(r=0;r<this.funcIndex.length;r++)if(!this.funcIndex[r]){i=r;break}}else this.funcIndex[t]&&(i=this.funcIndex.length);this.funcIndex[i]=!0;this.funcList[i]=n},run:function(n){var i,t;for(i in this.funcList)if(t=this.funcList[i],typeof t=="function")try{t.apply(n,arguments)}catch(r){console.error(r)}}},angularApp=angular.module("angularApp",["ui.bootstrap","ng.ueditor","ngSanitize","ngCsv"]),angularCtrl=function(n,t,i,r,u,f){n.$on("handleErrorOcurs",function(n,t){console.log("handleErrorOcurs",t)});n.getHtml=function(n){return r.trustAsHtml(n)};try{$angular.run(n,t,i,r,u,f);i(function(){$(".wait-loading").removeClass("wait-loading");$(".wait-loaded").removeClass("wait-loaded")})}catch(e){console.error(e)}};angularApp.service("$query",["$http","$q","$timeout","$sce",queryService]).controller("angularCtrl",["$scope","$query","$timeout","$sce","$compile","$interval",angularCtrl]);_dateOption={format:"YYYY-MM-DD",showTodayButton:!0,useCurrent:!1,keepInvalid:!0,locale:"zh-cn"};_dateTimeOption={format:"YYYY-MM-DD HH:mm",useCurrent:!1,sideBySide:!0,keepInvalid:!0,locale:"zh-cn"};angularApp.directive("mydatetimepicker",["$compile",function(){return{replace:!1,restrict:"C",link:function(n,t,i){var u=n.options,f,r;n.options||(u=n.showTime?_dateTimeOption:_dateOption);u.widgetParent=t.parent();t.datetimepicker(u);f=$moment(n.ngModel);f._isValid&&(n.ngModel=f.format(u.format),t.val(n.ngModel));t.on("keydown",function(t){return t.keyCode==8||t.keyCode==46?(this.value=n.ngModel="",!0):!1});r=t.data().DateTimePicker;n.minDate&&r.minDate(n.minDate);n.maxDate&&r.maxDate(n.maxDate);$('<i class="glyphicon glyphicon-calendar"><\/i>').insertAfter(t);n.$parent.$watch(i.ngMinDate,function(t){if(n.minDate)try{r.maxDate(!1);r.minDate($moment(n.minDate));n.maxDate&&r.maxDate($moment(n.maxDate))}catch(i){console.error(i,n)}return t});n.$parent.$watch(i.ngMaxDate,function(t){return n.maxDate&&(r.maxDate(!1),n.minDate&&r.minDate($moment(n.minDate)),r.maxDate($moment(n.maxDate))),t});n.$parent.$watch(i.ngModel,function(i){if(n.ngModel){var r=$moment(i);r._isValid&&(i=r.format(u.format),t.val(i))}return i})},scope:{ngModel:"=",minDate:"=ngMinDate",maxDate:"=ngMaxDate",options:"=ngDateOptions",showTime:"=ngShowTime"},require:"ngModel"}}]),function(n){n.fn.showImage=function(t){return n.showImage(this,t)};n.showImage=function(t,i){i?(i=i*1,i<1051&&(i=1051)):i=1051;var r=n('<div class="modal fade bs-example-modal-lg text-center" id="__imgModal" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel"><div class="modal-dialog modal-lg" style="display: inline-block; width: auto;"><div class="modal-content"><img id="__imgInModal" src=""><\/div><\/div><\/div>');t.find("img").on("click",function(t){t.stopPropagation();t.preventDefault();n("#__imgModal").length==0?n(document.body).append(r):r=n("#__imgModal");n("#__imgModal #__imgInModal").attr("src",this.src);r.on("showing.bs.modal",function(t){var r=n(t.delegateTarget);n(t.backdrop).css("z-index",i);r.css("z-index",i+10)}).modal("show")});return t}}(jQuery);